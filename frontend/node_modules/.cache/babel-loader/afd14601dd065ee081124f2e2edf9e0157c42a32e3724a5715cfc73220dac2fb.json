{"ast":null,"code":"import { RECONNECT_DELAY, RECONNECT_INTERVAL } from '../Providers/constants';\nexport var ReconnectEvent;\n(function (ReconnectEvent) {\n  ReconnectEvent[\"START_RECONNECT\"] = \"START_RECONNECT\";\n  ReconnectEvent[\"HALT_RECONNECT\"] = \"HALT_RECONNECT\";\n})(ReconnectEvent || (ReconnectEvent = {}));\n/**\n * Captures the reconnect event logic used to determine when to reconnect to PubSub providers.\n *   Reconnnect attempts are delayed by 5 seconds to let the interface settle.\n *   Attempting to reconnect only once creates unrecoverable states when the network state isn't\n *   supported by the browser, so this keeps retrying every minute until halted.\n */\nvar ReconnectionMonitor = /** @class */function () {\n  function ReconnectionMonitor() {\n    this.reconnectObservers = [];\n  }\n  /**\n   * Add reconnect observer to the list of observers to alert on reconnect\n   */\n  ReconnectionMonitor.prototype.addObserver = function (reconnectObserver) {\n    this.reconnectObservers.push(reconnectObserver);\n  };\n  /**\n   * Given a reconnect event, start the appropriate behavior\n   */\n  ReconnectionMonitor.prototype.record = function (event) {\n    var _this = this;\n    if (event === ReconnectEvent.START_RECONNECT) {\n      // If the reconnection hasn't been started\n      if (this.reconnectSetTimeoutId === undefined && this.reconnectIntervalId === undefined) {\n        this.reconnectSetTimeoutId = setTimeout(function () {\n          // Reconnect now\n          _this._triggerReconnect();\n          // Retry reconnect every periodically until it works\n          _this.reconnectIntervalId = setInterval(function () {\n            _this._triggerReconnect();\n          }, RECONNECT_INTERVAL);\n        }, RECONNECT_DELAY);\n      }\n    }\n    if (event === ReconnectEvent.HALT_RECONNECT) {\n      if (this.reconnectIntervalId) {\n        clearInterval(this.reconnectIntervalId);\n        this.reconnectIntervalId = undefined;\n      }\n      if (this.reconnectSetTimeoutId) {\n        clearTimeout(this.reconnectSetTimeoutId);\n        this.reconnectSetTimeoutId = undefined;\n      }\n    }\n  };\n  /**\n   * Complete all reconnect observers\n   */\n  ReconnectionMonitor.prototype.close = function () {\n    this.reconnectObservers.forEach(function (reconnectObserver) {\n      var _a;\n      (_a = reconnectObserver.complete) === null || _a === void 0 ? void 0 : _a.call(reconnectObserver);\n    });\n  };\n  ReconnectionMonitor.prototype._triggerReconnect = function () {\n    this.reconnectObservers.forEach(function (reconnectObserver) {\n      var _a;\n      (_a = reconnectObserver.next) === null || _a === void 0 ? void 0 : _a.call(reconnectObserver);\n    });\n  };\n  return ReconnectionMonitor;\n}();\nexport { ReconnectionMonitor };","map":{"version":3,"names":["RECONNECT_DELAY","RECONNECT_INTERVAL","ReconnectEvent","ReconnectionMonitor","reconnectObservers","prototype","addObserver","reconnectObserver","push","record","event","_this","START_RECONNECT","reconnectSetTimeoutId","undefined","reconnectIntervalId","setTimeout","_triggerReconnect","setInterval","HALT_RECONNECT","clearInterval","clearTimeout","close","forEach","_a","complete","call","next"],"sources":["../../src/utils/ReconnectionMonitor.ts"],"sourcesContent":[null],"mappings":"AAGA,SAASA,eAAe,EAAEC,kBAAkB,QAAQ,wBAAwB;AAE5E,WAAYC,cAGX;AAHD,WAAYA,cAAc;EACzBA,cAAA,uCAAmC;EACnCA,cAAA,qCAAiC;AAClC,CAAC,EAHWA,cAAc,KAAdA,cAAc;AAK1B;;;;;;AAMA,IAAAC,mBAAA;EAAA,SAAAA,oBAAA;IACS,KAAAC,kBAAkB,GAAqB,EAAE;EA0DlD;EAtDC;;;EAGAD,mBAAA,CAAAE,SAAA,CAAAC,WAAW,GAAX,UAAYC,iBAAiC;IAC5C,IAAI,CAACH,kBAAkB,CAACI,IAAI,CAACD,iBAAiB,CAAC;EAChD,CAAC;EAED;;;EAGAJ,mBAAA,CAAAE,SAAA,CAAAI,MAAM,GAAN,UAAOC,KAAqB;IAA5B,IAAAC,KAAA;IACC,IAAID,KAAK,KAAKR,cAAc,CAACU,eAAe,EAAE;MAC7C;MACA,IACC,IAAI,CAACC,qBAAqB,KAAKC,SAAS,IACxC,IAAI,CAACC,mBAAmB,KAAKD,SAAS,EACrC;QACD,IAAI,CAACD,qBAAqB,GAAGG,UAAU,CAAC;UACvC;UACAL,KAAI,CAACM,iBAAiB,EAAE;UACxB;UACAN,KAAI,CAACI,mBAAmB,GAAGG,WAAW,CAAC;YACtCP,KAAI,CAACM,iBAAiB,EAAE;UACzB,CAAC,EAAEhB,kBAAkB,CAAC;QACvB,CAAC,EAAED,eAAe,CAAC;;;IAIrB,IAAIU,KAAK,KAAKR,cAAc,CAACiB,cAAc,EAAE;MAC5C,IAAI,IAAI,CAACJ,mBAAmB,EAAE;QAC7BK,aAAa,CAAC,IAAI,CAACL,mBAAmB,CAAC;QACvC,IAAI,CAACA,mBAAmB,GAAGD,SAAS;;MAErC,IAAI,IAAI,CAACD,qBAAqB,EAAE;QAC/BQ,YAAY,CAAC,IAAI,CAACR,qBAAqB,CAAC;QACxC,IAAI,CAACA,qBAAqB,GAAGC,SAAS;;;EAGzC,CAAC;EAED;;;EAGAX,mBAAA,CAAAE,SAAA,CAAAiB,KAAK,GAAL;IACC,IAAI,CAAClB,kBAAkB,CAACmB,OAAO,CAAC,UAAAhB,iBAAiB;;MAChD,CAAAiB,EAAA,GAAAjB,iBAAiB,CAACkB,QAAQ,cAAAD,EAAA,uBAAAA,EAAA,CAAAE,IAAA,CAA1BnB,iBAAiB;IAClB,CAAC,CAAC;EACH,CAAC;EAEOJ,mBAAA,CAAAE,SAAA,CAAAY,iBAAiB,GAAzB;IACC,IAAI,CAACb,kBAAkB,CAACmB,OAAO,CAAC,UAAAhB,iBAAiB;;MAChD,CAAAiB,EAAA,GAAAjB,iBAAiB,CAACoB,IAAI,cAAAH,EAAA,uBAAAA,EAAA,CAAAE,IAAA,CAAtBnB,iBAAiB;IAClB,CAAC,CAAC;EACH,CAAC;EACF,OAAAJ,mBAAC;AAAD,CAAC,CA3DD"},"metadata":{},"sourceType":"module","externalDependencies":[]}