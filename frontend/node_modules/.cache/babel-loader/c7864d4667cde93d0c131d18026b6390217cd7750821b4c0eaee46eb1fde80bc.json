{"ast":null,"code":"// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport { getCurrTime, getByteLength, defaultConfig, isInteger } from './Utils';\nimport { ConsoleLogger as Logger } from '@aws-amplify/core';\nvar logger = new Logger('StorageCache');\n/**\n * Initialization of the cache\n *\n */\nvar StorageCache = /** @class */function () {\n  /**\n   * Initialize the cache\n   * @param config - the configuration of the cache\n   */\n  function StorageCache(config) {\n    this.config = Object.assign({}, config);\n    this.cacheCurSizeKey = this.config.keyPrefix + 'CurSize';\n    this.checkConfig();\n  }\n  StorageCache.prototype.getModuleName = function () {\n    return 'Cache';\n  };\n  StorageCache.prototype.checkConfig = function () {\n    // check configuration\n    if (!isInteger(this.config.capacityInBytes)) {\n      logger.error('Invalid parameter: capacityInBytes. It should be an Integer. Setting back to default.');\n      this.config.capacityInBytes = defaultConfig.capacityInBytes;\n    }\n    if (!isInteger(this.config.itemMaxSize)) {\n      logger.error('Invalid parameter: itemMaxSize. It should be an Integer. Setting back to default.');\n      this.config.itemMaxSize = defaultConfig.itemMaxSize;\n    }\n    if (!isInteger(this.config.defaultTTL)) {\n      logger.error('Invalid parameter: defaultTTL. It should be an Integer. Setting back to default.');\n      this.config.defaultTTL = defaultConfig.defaultTTL;\n    }\n    if (!isInteger(this.config.defaultPriority)) {\n      logger.error('Invalid parameter: defaultPriority. It should be an Integer. Setting back to default.');\n      this.config.defaultPriority = defaultConfig.defaultPriority;\n    }\n    if (this.config.itemMaxSize > this.config.capacityInBytes) {\n      logger.error('Invalid parameter: itemMaxSize. It should be smaller than capacityInBytes. Setting back to default.');\n      this.config.itemMaxSize = defaultConfig.itemMaxSize;\n    }\n    if (this.config.defaultPriority > 5 || this.config.defaultPriority < 1) {\n      logger.error('Invalid parameter: defaultPriority. It should be between 1 and 5. Setting back to default.');\n      this.config.defaultPriority = defaultConfig.defaultPriority;\n    }\n    if (Number(this.config.warningThreshold) > 1 || Number(this.config.warningThreshold) < 0) {\n      logger.error('Invalid parameter: warningThreshold. It should be between 0 and 1. Setting back to default.');\n      this.config.warningThreshold = defaultConfig.warningThreshold;\n    }\n    // set 5MB limit\n    var cacheLimit = 5 * 1024 * 1024;\n    if (this.config.capacityInBytes > cacheLimit) {\n      logger.error('Cache Capacity should be less than 5MB. Setting back to default. Setting back to default.');\n      this.config.capacityInBytes = defaultConfig.capacityInBytes;\n    }\n  };\n  /**\n   * produce a JSON object with meta-data and data value\n   * @param value - the value of the item\n   * @param options - optional, the specified meta-data\n   *\n   * @return - the item which has the meta-data and the value\n   */\n  StorageCache.prototype.fillCacheItem = function (key, value, options) {\n    var ret = {\n      key: key,\n      data: value,\n      timestamp: getCurrTime(),\n      visitedTime: getCurrTime(),\n      priority: options.priority,\n      expires: options.expires,\n      type: typeof value,\n      byteSize: 0\n    };\n    ret.byteSize = getByteLength(JSON.stringify(ret));\n    // for accurate size\n    ret.byteSize = getByteLength(JSON.stringify(ret));\n    return ret;\n  };\n  /**\n   * set cache with customized configuration\n   * @param config - customized configuration\n   *\n   * @return - the current configuration\n   */\n  StorageCache.prototype.configure = function (config) {\n    if (!config) {\n      return this.config;\n    }\n    if (config.keyPrefix) {\n      logger.warn(\"Don't try to configure keyPrefix!\");\n    }\n    this.config = Object.assign({}, this.config, config, config.Cache);\n    this.checkConfig();\n    return this.config;\n  };\n  return StorageCache;\n}();\nexport { StorageCache };","map":{"version":3,"names":["getCurrTime","getByteLength","defaultConfig","isInteger","ConsoleLogger","Logger","logger","StorageCache","config","Object","assign","cacheCurSizeKey","keyPrefix","checkConfig","prototype","getModuleName","capacityInBytes","error","itemMaxSize","defaultTTL","defaultPriority","Number","warningThreshold","cacheLimit","fillCacheItem","key","value","options","ret","data","timestamp","visitedTime","priority","expires","type","byteSize","JSON","stringify","configure","warn","Cache"],"sources":["../src/StorageCache.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}