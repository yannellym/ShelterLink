{"ast":null,"code":"// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport { __assign, __awaiter, __generator, __rest } from \"tslib\";\nimport { ConsoleLogger as Logger, Hub, StorageHelper } from '@aws-amplify/core';\nimport flatten from 'lodash/flatten';\nimport { addEventListener, notifyEventListeners } from '../common';\nimport { AWSPinpointProvider } from './Providers';\nimport { InAppMessageInteractionEvent } from './types';\nvar STORAGE_KEY_SUFFIX = '_inAppMessages';\nvar logger = new Logger('Notifications.InAppMessaging');\nvar InAppMessaging = /** @class */function () {\n  function InAppMessaging() {\n    var _this = this;\n    this.config = {};\n    this.listeningForAnalyticEvents = false;\n    this.pluggables = [];\n    this.storageSynced = false;\n    /**\n     * Configure InAppMessaging\n     * @param {Object} config - InAppMessaging configuration object\n     */\n    this.configure = function (_a) {\n      if (_a === void 0) {\n        _a = {};\n      }\n      var _b = _a.listenForAnalyticsEvents,\n        listenForAnalyticsEvents = _b === void 0 ? true : _b,\n        config = __rest(_a, [\"listenForAnalyticsEvents\"]);\n      _this.config = __assign(__assign({}, _this.config), config);\n      logger.debug('configure InAppMessaging', _this.config);\n      _this.pluggables.forEach(function (pluggable) {\n        pluggable.configure(_this.config[pluggable.getProviderName()]);\n      });\n      if (_this.pluggables.length === 0) {\n        _this.addPluggable(new AWSPinpointProvider());\n      }\n      if (listenForAnalyticsEvents && !_this.listeningForAnalyticEvents) {\n        Hub.listen('analytics', _this.analyticsListener);\n        _this.listeningForAnalyticEvents = true;\n      }\n      return _this.config;\n    };\n    /**\n     * Get a plugin from added plugins\n     * @param {string} providerName - the name of the plugin to get\n     */\n    this.getPluggable = function (providerName) {\n      var _a;\n      var pluggable = (_a = _this.pluggables.find(function (pluggable) {\n        return pluggable.getProviderName() === providerName;\n      })) !== null && _a !== void 0 ? _a : null;\n      if (!pluggable) {\n        logger.debug(\"No plugin found with name \" + providerName);\n      }\n      return pluggable;\n    };\n    /**\n     * Add plugin into InAppMessaging\n     * @param {InAppMessagingProvider} pluggable - an instance of the plugin\n     */\n    this.addPluggable = function (pluggable) {\n      if (pluggable && pluggable.getCategory() === 'Notifications' && pluggable.getSubCategory() === 'InAppMessaging') {\n        if (_this.getPluggable(pluggable.getProviderName())) {\n          throw new Error(\"Pluggable \" + pluggable.getProviderName() + \" has already been added.\");\n        }\n        _this.pluggables.push(pluggable);\n        pluggable.configure(_this.config[pluggable.getProviderName()]);\n      }\n    };\n    /**\n     * Remove a plugin from added plugins\n     * @param {string} providerName - the name of the plugin to remove\n     */\n    this.removePluggable = function (providerName) {\n      var index = _this.pluggables.findIndex(function (pluggable) {\n        return pluggable.getProviderName() === providerName;\n      });\n      if (index === -1) {\n        logger.debug(\"No plugin found with name \" + providerName);\n      } else {\n        _this.pluggables.splice(index, 1);\n      }\n    };\n    /**\n     * Get the map resources that are currently available through the provider\n     * @param {string} provider\n     * @returns - Array of available map resources\n     */\n    this.syncMessages = function () {\n      return Promise.all(_this.pluggables.map(function (pluggable) {\n        return __awaiter(_this, void 0, void 0, function () {\n          var messages, key, err_1;\n          return __generator(this, function (_a) {\n            switch (_a.label) {\n              case 0:\n                _a.trys.push([0, 3,, 4]);\n                return [4 /*yield*/, pluggable.getInAppMessages()];\n              case 1:\n                messages = _a.sent();\n                key = \"\" + pluggable.getProviderName() + STORAGE_KEY_SUFFIX;\n                return [4 /*yield*/, this.setMessages(key, messages)];\n              case 2:\n                _a.sent();\n                return [3 /*break*/, 4];\n              case 3:\n                err_1 = _a.sent();\n                logger.error('Failed to sync messages', err_1);\n                throw err_1;\n              case 4:\n                return [2 /*return*/];\n            }\n          });\n        });\n      }));\n    };\n\n    this.clearMessages = function () {\n      return Promise.all(_this.pluggables.map(function (pluggable) {\n        return __awaiter(_this, void 0, void 0, function () {\n          var key;\n          return __generator(this, function (_a) {\n            switch (_a.label) {\n              case 0:\n                key = \"\" + pluggable.getProviderName() + STORAGE_KEY_SUFFIX;\n                return [4 /*yield*/, this.removeMessages(key)];\n              case 1:\n                _a.sent();\n                return [2 /*return*/];\n            }\n          });\n        });\n      }));\n    };\n\n    this.dispatchEvent = function (event) {\n      return __awaiter(_this, void 0, void 0, function () {\n        var messages, flattenedMessages;\n        var _this = this;\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              return [4 /*yield*/, Promise.all(this.pluggables.map(function (pluggable) {\n                return __awaiter(_this, void 0, void 0, function () {\n                  var key, messages;\n                  return __generator(this, function (_a) {\n                    switch (_a.label) {\n                      case 0:\n                        key = \"\" + pluggable.getProviderName() + STORAGE_KEY_SUFFIX;\n                        return [4 /*yield*/, this.getMessages(key)];\n                      case 1:\n                        messages = _a.sent();\n                        return [2 /*return*/, pluggable.processInAppMessages(messages, event)];\n                    }\n                  });\n                });\n              }))];\n            case 1:\n              messages = _a.sent();\n              flattenedMessages = flatten(messages);\n              if (flattenedMessages.length) {\n                notifyEventListeners(InAppMessageInteractionEvent.MESSAGE_RECEIVED, this.conflictHandler(flattenedMessages));\n              }\n              return [2 /*return*/];\n          }\n        });\n      });\n    };\n\n    this.identifyUser = function (userId, userInfo) {\n      return Promise.all(_this.pluggables.map(function (pluggable) {\n        return __awaiter(_this, void 0, void 0, function () {\n          var err_2;\n          return __generator(this, function (_a) {\n            switch (_a.label) {\n              case 0:\n                _a.trys.push([0, 2,, 3]);\n                return [4 /*yield*/, pluggable.identifyUser(userId, userInfo)];\n              case 1:\n                _a.sent();\n                return [3 /*break*/, 3];\n              case 2:\n                err_2 = _a.sent();\n                logger.error('Failed to identify user', err_2);\n                throw err_2;\n              case 3:\n                return [2 /*return*/];\n            }\n          });\n        });\n      }));\n    };\n\n    this.onMessageReceived = function (handler) {\n      return addEventListener(InAppMessageInteractionEvent.MESSAGE_RECEIVED, handler);\n    };\n    this.onMessageDisplayed = function (handler) {\n      return addEventListener(InAppMessageInteractionEvent.MESSAGE_DISPLAYED, handler);\n    };\n    this.onMessageDismissed = function (handler) {\n      return addEventListener(InAppMessageInteractionEvent.MESSAGE_DISMISSED, handler);\n    };\n    this.onMessageActionTaken = function (handler) {\n      return addEventListener(InAppMessageInteractionEvent.MESSAGE_ACTION_TAKEN, handler);\n    };\n    this.notifyMessageInteraction = function (message, type) {\n      notifyEventListeners(type, message);\n    };\n    this.setConflictHandler = function (handler) {\n      _this.conflictHandler = handler;\n    };\n    this.analyticsListener = function (_a) {\n      var payload = _a.payload;\n      var event = payload.event,\n        data = payload.data;\n      switch (event) {\n        case 'record':\n          {\n            _this.dispatchEvent(data);\n            break;\n          }\n        default:\n          break;\n      }\n    };\n    this.syncStorage = function () {\n      return __awaiter(_this, void 0, void 0, function () {\n        var storage, err_3;\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              storage = this.config.storage;\n              _a.label = 1;\n            case 1:\n              _a.trys.push([1, 4,, 5]);\n              if (!(typeof storage.sync === 'function')) return [3 /*break*/, 3];\n              return [4 /*yield*/, storage.sync()];\n            case 2:\n              _a.sent();\n              _a.label = 3;\n            case 3:\n              this.storageSynced = true;\n              return [3 /*break*/, 5];\n            case 4:\n              err_3 = _a.sent();\n              logger.error('Failed to sync storage', err_3);\n              return [3 /*break*/, 5];\n            case 5:\n              return [2 /*return*/];\n          }\n        });\n      });\n    };\n\n    this.getMessages = function (key) {\n      return __awaiter(_this, void 0, void 0, function () {\n        var storage, storedMessages, err_4;\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              _a.trys.push([0, 3,, 4]);\n              if (!!this.storageSynced) return [3 /*break*/, 2];\n              return [4 /*yield*/, this.syncStorage()];\n            case 1:\n              _a.sent();\n              _a.label = 2;\n            case 2:\n              storage = this.config.storage;\n              storedMessages = storage.getItem(key);\n              return [2 /*return*/, storedMessages ? JSON.parse(storedMessages) : []];\n            case 3:\n              err_4 = _a.sent();\n              logger.error('Failed to retrieve in-app messages from storage', err_4);\n              return [3 /*break*/, 4];\n            case 4:\n              return [2 /*return*/];\n          }\n        });\n      });\n    };\n\n    this.setMessages = function (key, messages) {\n      return __awaiter(_this, void 0, void 0, function () {\n        var storage, err_5;\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              if (!messages) {\n                return [2 /*return*/];\n              }\n\n              _a.label = 1;\n            case 1:\n              _a.trys.push([1, 4,, 5]);\n              if (!!this.storageSynced) return [3 /*break*/, 3];\n              return [4 /*yield*/, this.syncStorage()];\n            case 2:\n              _a.sent();\n              _a.label = 3;\n            case 3:\n              storage = this.config.storage;\n              storage.setItem(key, JSON.stringify(messages));\n              return [3 /*break*/, 5];\n            case 4:\n              err_5 = _a.sent();\n              logger.error('Failed to store in-app messages', err_5);\n              return [3 /*break*/, 5];\n            case 5:\n              return [2 /*return*/];\n          }\n        });\n      });\n    };\n\n    this.removeMessages = function (key) {\n      return __awaiter(_this, void 0, void 0, function () {\n        var storage, err_6;\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              _a.trys.push([0, 3,, 4]);\n              if (!!this.storageSynced) return [3 /*break*/, 2];\n              return [4 /*yield*/, this.syncStorage()];\n            case 1:\n              _a.sent();\n              _a.label = 2;\n            case 2:\n              storage = this.config.storage;\n              storage.removeItem(key);\n              return [3 /*break*/, 4];\n            case 3:\n              err_6 = _a.sent();\n              logger.error('Failed to remove in-app messages from storage', err_6);\n              return [3 /*break*/, 4];\n            case 4:\n              return [2 /*return*/];\n          }\n        });\n      });\n    };\n\n    this.defaultConflictHandler = function (messages) {\n      // default behavior is to return the message closest to expiry\n      // this function assumes that messages processed by providers already filters out expired messages\n      var sorted = messages.sort(function (a, b) {\n        var _a, _b;\n        var endDateA = (_a = a.metadata) === null || _a === void 0 ? void 0 : _a.endDate;\n        var endDateB = (_b = b.metadata) === null || _b === void 0 ? void 0 : _b.endDate;\n        // if both message end dates are falsy or have the same date string, treat them as equal\n        if (endDateA === endDateB) {\n          return 0;\n        }\n        // if only message A has an end date, treat it as closer to expiry\n        if (endDateA && !endDateB) {\n          return -1;\n        }\n        // if only message B has an end date, treat it as closer to expiry\n        if (!endDateA && endDateB) {\n          return 1;\n        }\n        // otherwise, compare them\n        return new Date(endDateA) < new Date(endDateB) ? -1 : 1;\n      });\n      // always return the top sorted\n      return sorted[0];\n    };\n    this.config = {\n      storage: new StorageHelper().getStorage()\n    };\n    this.setConflictHandler(this.defaultConflictHandler);\n  }\n  /**\n   * Get the name of this module\n   * @returns {string} name of this module\n   */\n  InAppMessaging.prototype.getModuleName = function () {\n    return 'InAppMessaging';\n  };\n  return InAppMessaging;\n}();\nexport default InAppMessaging;","map":{"version":3,"names":["ConsoleLogger","Logger","Hub","StorageHelper","flatten","addEventListener","notifyEventListeners","AWSPinpointProvider","InAppMessageInteractionEvent","STORAGE_KEY_SUFFIX","logger","InAppMessaging","_this","config","listeningForAnalyticEvents","pluggables","storageSynced","configure","_a","_b","listenForAnalyticsEvents","__rest","__assign","debug","forEach","pluggable","getProviderName","length","addPluggable","listen","analyticsListener","getPluggable","providerName","find","getCategory","getSubCategory","Error","push","removePluggable","index","findIndex","splice","syncMessages","Promise","all","map","__awaiter","getInAppMessages","messages","sent","key","setMessages","error","err_1","clearMessages","removeMessages","dispatchEvent","event","getMessages","processInAppMessages","flattenedMessages","MESSAGE_RECEIVED","conflictHandler","identifyUser","userId","userInfo","err_2","onMessageReceived","handler","onMessageDisplayed","MESSAGE_DISPLAYED","onMessageDismissed","MESSAGE_DISMISSED","onMessageActionTaken","MESSAGE_ACTION_TAKEN","notifyMessageInteraction","message","type","setConflictHandler","payload","data","syncStorage","storage","sync","err_3","storedMessages","getItem","JSON","parse","err_4","setItem","stringify","err_5","removeItem","err_6","defaultConflictHandler","sorted","sort","a","b","endDateA","metadata","endDate","endDateB","Date","getStorage","prototype","getModuleName"],"sources":["../../src/InAppMessaging/InAppMessaging.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}